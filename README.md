[версия руководства на русском языке](https://github.com/genshin-base/main-site/blob/miniapp/README_ru.md)

## About App
Genshin Base — an application where Genshin Impact players can find up-to-date character builds and view recommended owners for weapons and artifacts. Convenient search, no unnecessary information, the ability to like a character or item, as well as plan resource farming in a special widget.

As the future lies with super-apps and visual information, the application leverages the maximum capabilities provided by Telegram for mini-apps. It also has the ability to share a character's page with other messenger users and save a character build as an image.

## About Styling
Currently, there are two themes for mini-apps in Telegram — light and dark. The provided color options are not sufficient for a complete application styling, so some colors have to be generated. An example of color generation, as well as an example of overriding default application styles for Telegram, can be found in [this file](https://github.com/genshin-base/main-site/blob/miniapp/www/src/miniapp-theme.scss).

There are colors that are not available in earlier versions of the bot. To generate them, JavaScript needs to be used, as demonstrated in [this file](https://github.com/genshin-base/main-site/blob/miniapp/www/src/miniapp-styling.tsx).

## About API Types Generation
Mini-apps API types (`Telegram.WebApp`, etc.) are generated by script `node scripts/tg/update_webapp_types.js` from [webapp doc page](https://core.telegram.org/bots/webapps) content.
Result is saved to [lib/telegram/webapp_types.d.ts](https://github.com/genshin-base/main-site/blob/miniapp/lib/telegram/webapp_types.d.ts).

## Share Build Button
Integration with the messenger would not be complete without the ability to share a direct link to a character's page with other users. Therefore, TODO.
https://github.com/genshin-base/main-site/blob/miniapp/www/src/modules/builds/character-build-detailed.tsx#L415

## Save Build as an Image Button
Currently, users find it important to have the option to save necessary information as an image. Genshin Base provides this capability. By using the Main Button, the user can save a build as an image. The button's initialization can be found in [this file](https://github.com/genshin-base/main-site/blob/miniapp/www/src/modules/builds/character-build-detailed.tsx#L78), and the click handler is described [here](https://github.com/genshin-base/main-site/blob/miniapp/www/src/modules/builds/character-build-detailed.tsx#L387).

## User Storage
To store items that a user has liked, Telegram's provided storage is used. The connection is described in [this file](https://github.com/genshin-base/main-site/blob/miniapp/www/src/utils/hooks.tsx#L128). If a situation arises where the user hasn't visited the application for a while and the data format for stored data has changed, the application retains the identifier of the current data format, as described in [this file](https://github.com/genshin-base/main-site/blob/miniapp/www/src/utils/hooks.tsx#L240).

## Native Popup for Quick Setup
The game has several servers in different time zones. The selected server determines what is available for farming today. To easily switch between servers, the application uses Telegram's native popup, with an example of usage in [this file](https://github.com/genshin-base/main-site/blob/miniapp/www/src/containers/time-until-day-reset.tsx#L37).

## How to run

`npm install`

### Frontend (HTML pages) of Mini App

### Generating build images

Pre-generating images that will be sent when sharing builds.

```bash
npm run build -- --env no-prerender
node scripts/render_build_images.js
```

#### Dev mode

You can just start dev-server in `https` mode and configure `https://127.0.0.1:8080` as webapp's URL.
That way you can develop and debug the webapp via Telegram [web-clients](https://web.telegram.org/).
But you'll have to first open the app URL in the browser directly and accept to use a self-signed certificate.

```bash
npm run dev -- --env tg-web-app-url=t.me/mybot/myapp --https
```

Or you can proxy requests from you domain with configured TLS. In that case it's better to add parameters
`--client-web-socket-url` and `--allowed-hosts` so HMR and page autoreload can work correctly.

```bash
npm run dev -- --client-web-socket-url ws://0.0.0.0:443/ws --allowed-hosts all --env tg-web-app-url=t.me/mybot/myapp

#### Prod mode

```bash
npm run build -- --env tg-web-app-url=t.me/mybot/myapp --env no-prerender
cp -r www/public/. www/dist/browser/
```

And serve `www/dist/browser` folder content (with `nginx` for example).

### Backend (bot)

```bash
TG_BOT_TOKEN=token WEBAPP_URL=t.me/mybot/myapp node tg_bot/index.js
```
